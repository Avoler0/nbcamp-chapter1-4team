<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  </head>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import {
      doc,
      collection,
      addDoc,
      updateDoc,
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import {
      getDocs,
      getDoc,
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDspAV1LiugBcx69J0dWIk979EKColRCMY",
      authDomain: "nbcamp4dollar.firebaseapp.com",
      projectId: "nbcamp4dollar",
      storageBucket: "nbcamp4dollar.appspot.com",
      messagingSenderId: "903810170431",
      appId: "1:903810170431:web:d06256df539d9edb0e828a",
      measurementId: "G-LBRL46HQYD",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    //현재 시간 얻기 함수
    const getCurrentTime = () => {
      const date = new Date();
      const Year = date.getFullYear();
      const Month = date.getMonth() + 1;
      const Day = date.getDay();
      const Hour = date.getHours();
      const Minute = date.getMinutes();
      const Second = date.getSeconds();
      const MSecond = date.getMilliseconds();
      return Year + Month + Day + Hour + Minute + Second + MSecond;
    };

    const handlerCommentAdd = async () => {
      // 댓글 입력
      const data = {
        memberId: "1", // 멤버 필드 아이디
        commentName: $("#nameInput").val(),
        commentText: $("#commentInput").val(),
        time: getCurrentTime(),
      };

      try {
        if (!data.commentName) {
          alert("이름을 작성하세요.");
        } else if (!data.commentText) {
          alert("내용을 작성하세요");
        } else {
          const result = await addDoc(collection(db, "comments"), data);
        }

        data.sort((a, b) => {
          return Number(a.data.time) - Number(b.data.time);
        });
        console.log(a.data.time);
        console.log(result);
      } catch (err) {
        console.log(err);
      }
    };

    $("#commentBtn").click(handlerCommentAdd);

    $("#goodBtn").click(async () => {
      // 좋아요 클릭

      try {
        const memberData = await getDoc(
          doc(db, "members", "DukIKijuszU2aoDRaZhR")
        );
        const { good } = memberData.data();

        await updateDoc(doc(db, "members", "DukIKijuszU2aoDRaZhR"), {
          good: good + 1,
        });
      } catch (err) {
        console.log(err);
      } finally {
        console.log("end");
      }
    });
  </script>
  <body>
    <div>
      <input type="text" id="nameInput" />
    </div>
    <div>
      <input type="text" id="commentInput" />
    </div>
    <button id="commentBtn">클릭</button>

    <button id="goodBtn">좋아요 클릭</button>
  </body>
</html>
